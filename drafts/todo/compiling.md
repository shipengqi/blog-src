---
title: compiling
tags:
---

## 抽象语法树

抽象语法树（AST），是源代码语法的结构的一种抽象表示，它用树状的方式表示编程语言的语法结构

抽象语法树中的每一个节点都表示源代码中的一个元素，每一颗子树都表示一个语法元素

例如 `2 * 3 + 7`


作为编译器常用的数据结构，抽象语法树抹去了源代码中不重要的一些字符 - 空格、分号或者括号等等。
**编译器在执行完语法分析之后会输出一个抽象语法树**，这个抽象语法树会辅助编译器进行语义分析，可以用它来确定语法
正确的程序是否存在一些类型不匹配或不一致的问题。


## 静态单赋值
静态单赋值（Static Single Assignment, SSA）是中间代码的一个特性，如果一个中间代码具有静态单赋值的特性，那么
每个变量就只会被赋值一次。

```go
x := 1
x := 2
y := x
```

`x := 1` 这一表达式在上述的代码片段中是没有作用的。

```go
x1 := 1
x2 := 2
y1 := x2
```

使用具有 SSA 特性的中间代码时，就可以非常清晰地发现变量 y1 的值和 x1 是完全没有任何关系的，所以在机器码生
成时其实就可以省略第一步，这样就能减少需要执行的指令来优化这一段代码。

## 指令集
x86 是目前比较常见的指令集，除了 x86 之外，还有很多其他的指令集，不同的处理器使用了不同的架构和机器语言，所以很多编程
语言为了在不同的机器上运行需要将源代码根据架构翻译成不同的机器代码。


## 编译原理
Go 语言编译器的源代码在 `src/cmd/compile` 目录中

学过编译原理的人可能听说过编译器的前端和后端，编译器的前端一般承担着词法分析、语法分析、类型检查和中间代码生成几
部分工作，而编译器后端主要负责目标代码的生成和优化，也就是将中间代码翻译成目标机器能够运行的二进制机器码。

### 核心过程
Go 的编译器在逻辑上可以被分成四个阶段：词法与语法分析、类型检查和 AST 转换、通用 SSA 生成和最后的机器代码生成

## 编译器入口
Go 语言的编译器入口在 `src/cmd/compile/internal/gc/main.go` 文件中

函数会先获取命令行传入的参数并更新编译选项和配置，随后就会开始运行 `parseFiles` 函数对输入的所有文件进行词法与语法
分析得到文件对应的抽象语法树
